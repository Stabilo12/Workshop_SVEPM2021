[["index.html", "Workshop 2 SVEPM 2021 Chapter 1 First break-out room 1.1 Create Phyloseq object 1.2 Calculate alpha-diversities", " Workshop 2 SVEPM 2021 J.G. Kers &amp; E.A.J. Fischer 2021-03-14 Chapter 1 First break-out room Study design data Load packages library(phyloseq) library(microbiome) library(data.table) library(RColorBrewer) library(ggpubr) library(readr) library(picante) library(nlme) library(ggplot2) library(ape) library(vegan) library(data.table) library(DT) 1.1 Create Phyloseq object Additional reading Phyloseq Let’s start with uploading the data, 3 files are needed: Biom file Metadata file Tree file The data we use in this workshop has been publised A phyloseq object contains information on: the abundances of the amplicon sequence variant (ASV), the taxonomy of the ASV, the phylogenetic tree, and the metadata of the samples. pseq &lt;- read_phyloseq(otu.file= &quot;BiomWorkshop.biom1&quot;, taxonomy.file = NULL, metadata.file = &quot;MetaWorkshop.csv&quot;, type=&quot;biom&quot;, sep =&quot;;&quot; ) treefile &lt;- read_tree(&quot;TreeWorkshop.tree&quot;) ps &lt;- merge_phyloseq(pseq, treefile) ps ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 489 taxa and 28 samples ] ## sample_data() Sample Data: [ 28 samples by 8 sample variables ] ## tax_table() Taxonomy Table: [ 489 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 489 tips and 488 internal nodes ] ps is the phyloseq object and contains 28 chicken samples and 489 ASV. We can view the taxonomy of the ASV within a taxa table: datatable(tax_table(ps)) The focus is on the diversities but a mini sequences controle cannot be missed. The datatable shows the presences of an unknown Domain (“NA”), we want to remove this. Do you know why? ps1 &lt;- subset_taxa(ps, Domain!=&quot;NA&quot;) ps1 ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 486 taxa and 28 samples ] ## sample_data() Sample Data: [ 28 samples by 8 sample variables ] ## tax_table() Taxonomy Table: [ 486 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 486 tips and 485 internal nodes ] Summary sequence data To review the sequence data in we can use the summary function summarize_phyloseq(ps1) ## Compositional = NO2 ## 1] Min. number of reads = 396052] Max. number of reads = 2612713] Total number of reads = 35815914] Average number of reads = 127913.9642857145] Median number of reads = 1099827] Sparsity = 0.8179012345679016] Any OTU sum to 1 or less? NO8] Number of singletons = 09] Percent of OTUs that are singletons ## (i.e. exactly one read detected across all samples)010] Number of sample variables are: 8BarcodeSequenceLibraryNumberLibraryNameProjectNameX16S_regionprimersPenFeed2 ## [[1]] ## [1] &quot;1] Min. number of reads = 39605&quot; ## ## [[2]] ## [1] &quot;2] Max. number of reads = 261271&quot; ## ## [[3]] ## [1] &quot;3] Total number of reads = 3581591&quot; ## ## [[4]] ## [1] &quot;4] Average number of reads = 127913.964285714&quot; ## ## [[5]] ## [1] &quot;5] Median number of reads = 109982&quot; ## ## [[6]] ## [1] &quot;7] Sparsity = 0.817901234567901&quot; ## ## [[7]] ## [1] &quot;6] Any OTU sum to 1 or less? NO&quot; ## ## [[8]] ## [1] &quot;8] Number of singletons = 0&quot; ## ## [[9]] ## [1] &quot;9] Percent of OTUs that are singletons \\n (i.e. exactly one read detected across all samples)0&quot; ## ## [[10]] ## [1] &quot;10] Number of sample variables are: 8&quot; ## ## [[11]] ## [1] &quot;BarcodeSequence&quot; &quot;LibraryNumber&quot; &quot;LibraryName&quot; &quot;ProjectName&quot; &quot;X16S_region&quot; &quot;primers&quot; &quot;Pen&quot; &quot;Feed&quot; What is the number of singletons in this dataset? Check rarefaction The number of species = ASV (y-as) should reach a plateau if the sample size = reads (x-as) is large enough. otu_tab &lt;- t(abundances(ps1)) p &lt;- vegan::rarecurve(otu_tab, step = 50, label = FALSE, sample = min(rowSums(otu_tab), Col =&quot;red&quot;, cex = 0.5)) 1.2 Calculate alpha-diversities Let’s first visualize the data plot_richness(ps1, &quot;Pen&quot;, &quot;Feed&quot;, measures=c(&quot;Observed&quot;, &quot;Shannon&quot;, &quot;Simpson&quot;, &quot;InvSimpson&quot;)) What stands out? Let’s test the four different (non-phylogenetic) alpha diversities on feed and pen alpha &lt;- estimate_richness(ps1, measures = c(&quot;Observed&quot;, &quot;Shannon&quot;, &quot;Simpson&quot;, &quot;InvSimpson&quot; )) meta &lt;- meta(ps1) #extract metadata Observed kruskal.pd &lt;- kruskal.test(alpha$Observed ~ meta$Feed) print(kruskal.pd) ## ## Kruskal-Wallis rank sum test ## ## data: alpha$Observed by meta$Feed ## Kruskal-Wallis chi-squared = 16.755, df = 1, p-value = 4.253e-05 pairwise.wilcox.test(alpha$Observed, meta$Pen, p.adjust.method = &quot;BH&quot;) ## ## Pairwise comparisons using Wilcoxon rank sum test with continuity correction ## ## data: alpha$Observed and meta$Pen ## ## 1 2 3 ## 2 0.7478 - - ## 3 0.0249 0.0107 - ## 4 0.0064 0.0064 0.0065 ## ## P value adjustment method: BH Simpson kruskal.pd &lt;- kruskal.test(alpha$Simpson ~ meta$Feed) print(kruskal.pd) ## ## Kruskal-Wallis rank sum test ## ## data: alpha$Simpson by meta$Feed ## Kruskal-Wallis chi-squared = 14.196, df = 1, p-value = 0.0001648 pairwise.wilcox.test(alpha$Simpson, meta$Pen, p.adjust.method = &quot;BH&quot;) ## ## Pairwise comparisons using Wilcoxon rank sum exact test ## ## data: alpha$Simpson and meta$Pen ## ## 1 2 3 ## 2 0.0455 - - ## 3 0.0035 0.2086 - ## 4 0.0012 0.0012 0.0012 ## ## P value adjustment method: BH Shannon kruskal.pd &lt;- kruskal.test(alpha$Shannon ~ meta$Feed) print(kruskal.pd) ## ## Kruskal-Wallis rank sum test ## ## data: alpha$Shannon by meta$Feed ## Kruskal-Wallis chi-squared = 15.98, df = 1, p-value = 6.403e-05 pairwise.wilcox.test(alpha$Shannon, meta$Pen, p.adjust.method = &quot;BH&quot;) ## ## Pairwise comparisons using Wilcoxon rank sum exact test ## ## data: alpha$Shannon and meta$Pen ## ## 1 2 3 ## 2 0.1282 - - ## 3 0.0105 0.0315 - ## 4 0.0012 0.0012 0.0012 ## ## P value adjustment method: BH Phylogenetic diversity #library(picante) ps.otu &lt;- as.data.frame(ps1@otu_table) ps.tree &lt;- ps1@phy_tree df.pd &lt;- pd(t(ps.otu), treefile, include.root=T) # rooted tree meta$Phylogenetic_Diversity &lt;- df.pd$PD pd.plot &lt;- ggboxplot(meta, x = &quot;Pen&quot;, y = &quot;Phylogenetic_Diversity&quot;, fill = &quot;Feed&quot;) pd.plot kruskal.pd &lt;- kruskal.test(meta$Phylogenetic_Diversity ~ meta$Pen) print(kruskal.pd) ## ## Kruskal-Wallis rank sum test ## ## data: meta$Phylogenetic_Diversity by meta$Pen ## Kruskal-Wallis chi-squared = 22.33, df = 3, p-value = 5.569e-05 pairwise.wilcox.test(meta$Phylogenetic_Diversity, meta$Pen, p.adjust.method = &quot;BH&quot;) ## ## Pairwise comparisons using Wilcoxon rank sum exact test ## ## data: meta$Phylogenetic_Diversity and meta$Pen ## ## 1 2 3 ## 2 0.2593 - - ## 3 0.0017 0.0028 - ## 4 0.0012 0.0012 0.0012 ## ## P value adjustment method: BH Additional reading Shetty Sudarshan A, Lahti Leo, Hermes Gerben DA, &amp; Hauke Smidt. (2020, April 11) Microbial bioinformatics introductory course material 2018 (Version v3.0). Zenodo http://doi.org/10.5281/zenodo.1436630 "],["second-break-out-room.html", "Chapter 2 Second break-out room", " Chapter 2 Second break-out room Calculate beta diversties "],["third-break-out-room.html", "Chapter 3 Third break-out room", " Chapter 3 Third break-out room Visualization and statistics "]]
